%% protobuf-rs 整体架构图
graph TB
    subgraph "JavaScript Layer (Node.js)"
        API[Public API]
        Compat[protobufjs-compat.js]
        Adapter[protobufjs-adapter.js]
    end

    subgraph "NAPI Bridge Layer"
        NAPI[NAPI-RS Bindings]
    end

    subgraph "Rust Core Layer"
        subgraph "Core Functions"
            Varint[Varint Encode/Decode]
            ZigZag[ZigZag Encode/Decode]
            FieldTag[Field Tag Operations]
        end

        subgraph "Advanced I/O"
            Reader[Reader - Zero-Copy Read]
            Writer[Writer - Buffered Write]
        end

        subgraph "Performance Optimizations"
            SIMD[SIMD Batch Operations]
            Parallel[Parallel Processing - Rayon]
            Pool[Memory Pool]
        end
    end

    subgraph "Protocol Buffers Ecosystem"
        ProtoJS[protobuf.js<br/>Schema/Type System]
        Proto[.proto Files]
    end

    %% Data Flow
    API --> Compat
    Compat --> ProtoJS
    Compat --> Adapter
    Adapter --> NAPI
    NAPI --> Varint
    NAPI --> ZigZag
    NAPI --> FieldTag
    NAPI --> Reader
    NAPI --> Writer
    NAPI --> SIMD
    NAPI --> Parallel
    
    Reader --> Pool
    Writer --> Pool
    SIMD --> Pool
    Parallel --> Pool

    ProtoJS --> Proto
    
    %% Performance Path
    API -.快速路径.-> Adapter
    Adapter -.零拷贝.-> Reader
    Adapter -.缓冲复用.-> Writer

    style Varint fill:#90EE90
    style Reader fill:#90EE90
    style Writer fill:#90EE90
    style SIMD fill:#FFD700
    style Parallel fill:#FFD700
    style Pool fill:#FFD700
